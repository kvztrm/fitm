-- AutoFish Notifier - Full index scan (0-150) in Folder1/2/3
-- Only reports the exact fish types you listed, grouped webhook

local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

local WEBHOOK_URL = "https://discord.com/api/webhooks/1469813322936356956/7vOLfjATJUvnwcKcUACeMOpC6-KssMk6P6pSsNzajaJXHRWY5PhPuq9rE2WJQsNJ2u2n"

local THRESHOLD = 50
local MAX_INDEX = 150
local SCAN_INTERVAL = 90   -- seconds
local DEBUG = true

-- Folders
local fpp = workspace:WaitForChild("FrameWork_WorkSpace", 10)
    :WaitForChild("FishPPPart", 5)

local folder1 = fpp:WaitForChild("Folder1", 5)
local folder2 = fpp:WaitForChild("Folder2", 5)
local folder3 = fpp:WaitForChild("Folder3", 5)

local folders = {folder1, folder2, folder3}

-- Your exact fish names (case-insensitive match)
local wantedFish = {
    "sea dweller",
    "scp3000", "scp-300", "scp 300",
    "plesiosaurus",
    "hammerhead shark", "hammerhead",
    "bloop",
    "el gran maja", "gran maja",
    "julia beast",
    "ningen",
    "megalodon",
    "zombie fish",
    "sea eater",
    "bone shark", "boneshark",
    "shark girl",
    "shark boy",
    "king squid",
    "sea reaper"
}

-- Check if name matches any wanted fish (case-insensitive)
local function isWantedFish(name)
    if not name then return false end
    local lower = name:lower()
    for _, w in ipairs(wantedFish) do
        if lower:find(w, 1, true) then
            return true
        end
    end
    return false
end

-- Get text from ProximityPrompt
local function getPromptText(part)
    if not part then return nil end

    local prompt = part:FindFirstChild("PPPart_PP")
    if not prompt or not prompt:IsA("ProximityPrompt") then return nil end

    local obj = prompt.ObjectText or ""
    local act = prompt.ActionText or ""
    return obj .. " " .. act
end

-- Extract percentage
local function extractPercentage(text)
    if not text or text == "" then return nil end

    local clean = text:lower():gsub("%s+", "")
    local patterns = {
        "(%d+%.?%d*)%%",
        "(%d+)%%",
        "(%d+%.?%d*) ?percent",
        "%%(%d+)"
    }

    for _, pat in ipairs(patterns) do
        local numStr = clean:match(pat)
        if numStr then
            local v = tonumber(numStr)
            if v and v >= THRESHOLD then return v end
        end
    end

    return nil
end

-- Your exact webhook sender function
local function SendWebhook(payload)
    local headers = {["Content-Type"] = "application/json"}
    local body = HttpService:JSONEncode(payload)
    
    local success, response = pcall(function()
        return request({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = headers,
            Body = body
        })
    end)
    
    if success then
        print("[WEBHOOK] Sent! Status: " .. (response.StatusCode or "no code"))
    else
        warn("[WEBHOOK] Failed: " .. tostring(response))
    end
end

-- Send one grouped webhook
local lastSend = 0

local function sendGrouped(detected)
    local now = tick()
    if now - lastSend < 30 then return end
    lastSend = now

    if #detected == 0 then return end

    local lines = {}
    for i, f in ipairs(detected) do
        table.insert(lines, i .. ". **" .. f.name .. "** - **" .. f.percent .. "%**")
    end

    local message = "**High % Fish Detected (" .. #detected .. " total):**\n" .. table.concat(lines, "\n")

    SendWebhook({content = message})
end

-- Scan loop - checks 0 to 150 in each folder
local lastScan = 0

RunService.Heartbeat:Connect(function()
    local now = tick()
    if now - lastScan < SCAN_INTERVAL then return end
    lastScan = now

    if DEBUG then print("[SCAN START] Indices 0–" .. MAX_INDEX .. " in all folders") end

    local detected = {}

    for fIdx, folder in ipairs(folders) do
        if not folder then continue end

        for i = 0, MAX_INDEX do
            local child = folder:GetChildren()[i + 1]  -- Lua is 1-based
            if not child then continue end

            local text = getPromptText(child)
            if text then
                local value = extractPercentage(text)
                if value then
                    local name = child.Name or ("Idx " .. i)
                    if isWantedFish(name) or isWantedFish(text) then
                        table.insert(detected, {name = name, percent = value})
                        if DEBUG then
                            print("[HIGH] " .. name .. " @ " .. value .. "% (Folder " .. fIdx .. ", idx " .. i .. ")")
                        end
                    end
                end
            end
        end
    end

    sendGrouped(detected)

    if DEBUG then print("[SCAN END] Found " .. #detected .. " matching fish ≥ " .. THRESHOLD .. "%") end
end)

print("[FishScanner] Active - only specified fish types - indices 0–" .. MAX_INDEX .. " - threshold ≥ " .. THRESHOLD .. "%")
