-- TEMP DEBUG SCRIPT - No webhook sending, just massive logging
-- Shows exactly what the script sees in PPPart_PP

local RunService = game:GetService("RunService")

local THRESHOLD = 50
local MAX_INDEX = 150
local DEBUG = true

-- Folders
local fpp = workspace:WaitForChild("FrameWork_WorkSpace", 10)
    :WaitForChild("FishPPPart", 5)

local folder1 = fpp:WaitForChild("Folder1", 5)
local folder2 = fpp:WaitForChild("Folder2", 5)
local folder3 = fpp:WaitForChild("Folder3", 5)

local folders = {folder1, folder2, folder3}

print("[DEBUG MODE] No webhook will be sent. Only printing what is found.")

-- Get name and action text
local function getPromptInfo(part)
    if not part then
        print("[SKIP] Part is nil")
        return nil, nil
    end

    local prompt = part:FindFirstChild("PPPart_PP")
    if not prompt then
        print("[SKIP] No PPPart_PP in " .. part:GetFullName())
        return nil, nil
    end

    if not prompt:IsA("ProximityPrompt") then
        print("[SKIP] PPPart_PP is not ProximityPrompt in " .. part:GetFullName())
        return nil, nil
    end

    local name = prompt.ObjectText or ""
    local action = prompt.ActionText or ""

    print("[PROMPT FOUND] " .. part:GetFullName())
    print("   ObjectText: " .. name)
    print("   ActionText: " .. action)

    return name, action
end

-- Extract percentage
local function extractPercentage(name, action)
    local text = (name or "") .. " " .. (action or "")
    if text == "" then
        print("[PARSE] No text to parse")
        return nil
    end

    local clean = text:lower():gsub("%s+", "")
    print("[PARSE INPUT] " .. text:sub(1, 100) .. (text:len() > 100 and "..." or ""))

    local patterns = {
        "(%d+%.?%d*)%%",
        "(%d+)%%",
        "(%d+%.?%d*) ?percent",
        "%%(%d+)"
    }

    for _, pat in ipairs(patterns) do
        local numStr = clean:match(pat)
        if numStr then
            local v = tonumber(numStr)
            if v then
                print("[PARSE MATCH] Pattern '" .. pat .. "' → " .. v)
                if v >= THRESHOLD then
                    print("[ACCEPT] " .. v .. "% ≥ " .. THRESHOLD)
                    return v
                else
                    print("[REJECT] " .. v .. "% < " .. THRESHOLD)
                end
            else
                print("[PARSE FAIL] tonumber failed on '" .. numStr .. "'")
            end
        end
    end

    print("[PARSE] No valid percentage found")
    return nil
end

-- Manual test scan on start
print("[TEST SCAN] Running manual scan once at start...")

for fIdx, folder in ipairs(folders) do
    if not folder then
        print("[FOLDER MISSING] Folder" .. fIdx)
        continue
    end

    print("[FOLDER] " .. folder:GetFullName() .. " (" .. #folder:GetChildren() .. " children)")

    for i = 0, MAX_INDEX do
        local child = folder:GetChildren()[i + 1]
        if not child then continue end

        print("[CHECK] " .. child:GetFullName() .. " (index " .. i .. ")")

        local name, action = getPromptInfo(child)
        if name then
            local percent = extractPercentage(name, action)
            if percent then
                print("[RESULT] " .. name .. " → " .. percent .. "% (≥ " .. THRESHOLD .. "%)")
            else
                print("[RESULT] No valid %")
            end
        else
            print("[RESULT] No valid prompt")
        end
    end
end

print("[TEST SCAN] Finished. Check above for details.")

-- Optional: periodic scan (comment out if you only want one test)
--[[
local lastScan = 0

RunService.Heartbeat:Connect(function()
    local now = tick()
    if now - lastScan < SCAN_INTERVAL then return end
    lastScan = now

    print("[PERIODIC SCAN] Starting...")
    -- (same scan code as above)
    print("[PERIODIC SCAN] End")
end)
--]]

print("[DEBUG MODE ACTIVE] No webhook sent. Look at output above.")
