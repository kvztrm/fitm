-- AutoFish Exploit Notifier - Scans ALL fish in Folder1/2/3, threshold 150+, grouped webhook
-- No fixed indices - counts every fish with PPPart_PP ProximityPrompt

local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

local WEBHOOK_URL = "https://discord.com/api/webhooks/1469813322936356956/7vOLfjATJUvnwcKcUACeMOpC6-KssMk6P6pSsNzajaJXHRWY5PhPuq9rE2WJQsNJ2u2n"

local THRESHOLD = 150
local SCAN_INTERVAL = 90   -- seconds between scans
local DEBUG = true

-- Folders
local fpp = workspace:WaitForChild("FrameWork_WorkSpace", 10)
    :WaitForChild("FishPPPart", 5)

local folder1 = fpp:WaitForChild("Folder1", 5)
local folder2 = fpp:WaitForChild("Folder2", 5)
local folder3 = fpp:WaitForChild("Folder3", 5)

local folders = {folder1, folder2, folder3}

print("[FishScanner] Starting full folder scan (all children)")

-- Get text from ProximityPrompt
local function getPromptText(fishPart)
    if not fishPart then return nil, nil end

    local prompt = fishPart:FindFirstChild("PPPart_PP")
    if not prompt or not prompt:IsA("ProximityPrompt") then return nil, nil end

    local objText = prompt.ObjectText or "Unknown Fish"
    local actText = prompt.ActionText or ""

    return objText, actText
end

-- Extract percentage (improved accuracy)
local function extractPercentage(actText, objText)
    local text = (actText or "") .. " " .. (objText or "")
    if text == "" then return nil end

    local clean = text:lower():gsub("%s+", "")
    local patterns = {
        "(%d+%.?%d*)%%",
        "(%d+)%%",
        "(%d+%.?%d*) ?percent",
        "%%(%d+)",
        "(%d+%.?%d*)"
    }

    for _, pat in ipairs(patterns) do
        local numStr = clean:match(pat)
        if numStr then
            local v = tonumber(numStr)
            if v and v >= THRESHOLD then return v end
        end
    end

    return nil
end

-- WeAreDevs-style webhook sender
local function SendWebhook(payload)
    local headers = {["Content-Type"] = "application/json"}
    local body = HttpService:JSONEncode(payload)

    local success, response = pcall(function()
        return request({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = headers,
            Body = body
        })
    end)

    if success then
        print("[WEBHOOK] Sent successfully! Status: " .. (response.StatusCode or "no code"))
    else
        warn("[WEBHOOK] Failed: " .. tostring(response))
    end
end

-- Send one combined webhook with all high fish
local lastSend = 0

local function sendCombined(highFishes)
    local now = tick()
    if now - lastSend < 30 then return end
    lastSend = now

    if #highFishes == 0 then return end

    local message = "**High % Fish Detected (" .. #highFishes .. " total):**\n"
    for i, fish in ipairs(highFishes) do
        message = message .. i .. ". **" .. fish.name .. "** - **" .. fish.percent .. "%**\n"
    end

    local payload = { content = message }

    SendWebhook(payload)
end

-- Scan all folders every SCAN_INTERVAL seconds
local lastScan = 0

RunService.Heartbeat:Connect(function()
    local now = tick()
    if now - lastScan < SCAN_INTERVAL then return end
    lastScan = now

    if DEBUG then print("[SCAN START] Checking all fish in folders...") end

    local highFishes = {}

    for _, folder in ipairs(folders) do
        if not folder then continue end

        for _, child in ipairs(folder:GetChildren()) do
            local fishName, actionText = getPromptText(child)
            if fishName then
                local percent = extractPercentage(actionText, fishName)
                if percent then
                    table.insert(highFishes, {name = fishName, percent = percent})
                    if DEBUG then
                        print("[HIGH] " .. fishName .. " at " .. percent .. "%")
                    end
                end
            end
        end
    end

    sendCombined(highFishes)

    if DEBUG then print("[SCAN END] Found " .. #highFishes .. " high fish - next scan in " .. SCAN_INTERVAL .. "s") end
end)

print("[FishScanner] Active - scanning ALL fish in Folder1/2/3 every " .. SCAN_INTERVAL .. " seconds")
